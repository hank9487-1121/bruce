-- ====== åŸºæœ¬æœå‹™ ======
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- ====== è…³æœ¬åˆ—è¡¨ ======
local Scripts = {}

-- ====== ç©å®¶ ESP ======
Scripts["ç©å®¶ ESP"] = {
    Enabled = false,
    _connections = {},
    Func = function(self)
        local NAME_SIZE = 18
        local ENEMY_NAME_COLOR = Color3.fromRGB(255,80,80)
        local ENEMY_HP_COLOR_START = Color3.fromRGB(255,60,60)
        local ENEMY_HP_COLOR_END = Color3.fromRGB(0,255,80)

        local EspFolder = Instance.new("Folder")
        EspFolder.Name = "PlayerESP"
        EspFolder.Parent = PlayerGui

        local function createPlayerESP(player)
            if player == Player then return end
            local gui = Instance.new("BillboardGui")
            gui.Size = UDim2.new(0,140,0,50)
            gui.StudsOffset = Vector3.new(0,3,0)
            gui.AlwaysOnTop = true
            gui.Name = player.Name.."_ESP"
            gui.Parent = EspFolder

            local nameLabel = Instance.new("TextLabel")
            nameLabel.Size = UDim2.new(1,0,0.5,0)
            nameLabel.BackgroundTransparency = 1
            nameLabel.Font = Enum.Font.SourceSansBold
            nameLabel.TextSize = NAME_SIZE
            nameLabel.TextStrokeTransparency = 0
            nameLabel.TextColor3 = ENEMY_NAME_COLOR
            nameLabel.Parent = gui

            local hpBack = Instance.new("Frame")
            hpBack.Size = UDim2.new(1,0,0.18,0)
            hpBack.Position = UDim2.new(0,0,0.65,0)
            hpBack.BackgroundColor3 = Color3.fromRGB(40,40,40)
            hpBack.BorderSizePixel = 0
            hpBack.Parent = gui
            Instance.new("UICorner", hpBack).CornerRadius=UDim.new(0,6)

            local hpBar = Instance.new("Frame")
            hpBar.Size = UDim2.new(1,0,1,0)
            hpBar.BackgroundColor3 = ENEMY_HP_COLOR_START
            hpBar.BorderSizePixel = 0
            hpBar.Parent = hpBack
            Instance.new("UICorner", hpBar).CornerRadius=UDim.new(0,6)

            local conn
            conn = RunService.RenderStepped:Connect(function()
                if not self.Enabled then
                    gui.Enabled = false
                    return
                end
                local char = player.Character
                local myChar = Player.Character
                if char and myChar and char:FindFirstChild("HumanoidRootPart") and char:FindFirstChild("Humanoid") then
                    gui.Adornee = char.HumanoidRootPart
                    gui.Enabled = true
                    local dist = math.floor((myChar.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude)
                    nameLabel.Text = player.Name.." ["..dist.."m]"
                    local hpPercent = math.clamp(char.Humanoid.Health/char.Humanoid.MaxHealth,0,1)
                    hpBar.Size = UDim2.new(hpPercent,0,1,0)
                    hpBar.BackgroundColor3 = ENEMY_HP_COLOR_START:Lerp(ENEMY_HP_COLOR_END,1-hpPercent)
                else
                    gui.Enabled = false
                end
            end)
            self._connections[player] = conn

            player.AncestryChanged:Connect(function()
                if not player:IsDescendantOf(game) then
                    if conn then conn:Disconnect() end
                    gui:Destroy()
                end
            end)
        end

        for _,plr in ipairs(Players:GetPlayers()) do createPlayerESP(plr) end
        Players.PlayerAdded:Connect(createPlayerESP)
    end,
    StopFunc = function(self)
        self.Enabled = false
        for _,conn in pairs(self._connections) do
            if conn then conn:Disconnect() end
        end
        self._connections = {}
        local espFolder = PlayerGui:FindFirstChild("PlayerESP")
        if espFolder then espFolder:Destroy() end
    end
}

-- ====== å¿«é€Ÿæ”»æ“Š ======
Scripts["å¿«é€Ÿæ”»æ“Š"] = {
    Enabled = false,
    Func = function(self)
        -- å…§åµŒå¿«é€Ÿæ”»æ“Šç°¡å–®ç¯„ä¾‹
        self._conn = RunService.RenderStepped:Connect(function()
            if not self.Enabled then return end
            -- å‡è¨­å¿«é€Ÿæ”»æ“Šæ˜¯æŒ‰ F
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.F, false, game)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.F, false, game)
        end)
    end,
    StopFunc = function(self)
        self.Enabled = false
        if self._conn then self._conn:Disconnect() end
        self._conn = nil
    end
}

-- ====== è‡ªå‹•æŒ‰ T ======
Scripts["è‡ªå‹•v3"] = {
    Enabled = false,
    Func = function(self)
        if self._conn then return end
        self._conn = task.spawn(function()
            while self.Enabled do
                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.T, false, game)
                task.wait(0.01)
                VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.T, false, game)
                task.wait(0.1)
            end
        end)
    end,
    StopFunc = function(self)
        self.Enabled = false
        self._conn = nil
    end
}

-- ====== é£›è¡Œ GUI ======
Scripts["é£›è¡Œ GUI"] = {
    Enabled=false,
    Func=function(self)
        -- é€™è£¡å¯ä»¥æ›æˆä½ å–œæ­¡çš„é£›è¡Œ GUI URL
        local success,err=pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
        end)
        if not success then warn("é£›è¡Œ GUI åŸ·è¡Œå¤±æ•—:",err) end
    end,
    StopFunc=function(self)
        warn("é£›è¡Œ GUI ç„¡æ³•è‡ªå‹•é—œé–‰")
    end
}

-- ====== è‡ªç„ ======
Scripts["å¸ƒé­¯æ–¯æœ€æ„›çš„è‡ªç„"] = {
    Enabled=false,
    Func=function(self)
        -- å…§åµŒç°¡å–®è‡ªç„ç¤ºæ„
        print("è‡ªç„å·²å•Ÿå‹•")
        -- ä½ å¯ä»¥æ”¾å¯¦éš›è‡ªç„é‚è¼¯
    end,
    StopFunc=function(self)
        warn("è‡ªç„ç„¡æ³•è‡ªå‹•é—œé–‰")
    end
}

-- ====== GUI ======
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "IntegratedHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local Main = Instance.new("Frame")
Main.Size = UDim2.new(0,340,0,440)
Main.Position = UDim2.new(0.5,-170,0.5,-220)
Main.BackgroundColor3 = Color3.fromRGB(28,28,28)
Main.BorderSizePixel = 0
Main.Parent = ScreenGui
Instance.new("UICorner",Main).CornerRadius = UDim.new(0,14)

local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1,0,0,50)
TopBar.BackgroundColor3 = Color3.fromRGB(40,40,40)
TopBar.BorderSizePixel = 0
TopBar.Parent = Main
Instance.new("UICorner",TopBar).CornerRadius = UDim.new(0,14)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1,-90,1,0)
Title.Position = UDim2.new(0,14,0,0)
Title.BackgroundTransparency = 1
Title.Text = "ğŸ”¥ Bruce Integrated Hub"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.Parent = TopBar

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0,40,0,30)
CloseBtn.Position = UDim2.new(1,-48,0.5,-15)
CloseBtn.Text = "âœ•"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 20
CloseBtn.TextColor3 = Color3.fromRGB(255,100,100)
CloseBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
CloseBtn.Parent = TopBar
Instance.new("UICorner",CloseBtn).CornerRadius = UDim.new(0,8)

local Content = Instance.new("ScrollingFrame")
Content.Size = UDim2.new(1,-16,1,-66)
Content.Position = UDim2.new(0,8,0,58)
Content.CanvasSize = UDim2.new(0,0,0,0)
Content.ScrollBarImageTransparency = 0.3
Content.BackgroundTransparency = 1
Content.BorderSizePixel = 0
Content.Parent = Main

local Layout = Instance.new("UIListLayout")
Layout.Padding = UDim.new(0,12)
Layout.Parent = Content

Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    Content.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y + 10)
end)

local function Section(text)
    local L = Instance.new("TextLabel")
    L.Size = UDim2.new(1,0,0,26)
    L.BackgroundTransparency = 1
    L.Text = text
    L.Font = Enum.Font.GothamBold
    L.TextSize = 16
    L.TextXAlignment = Enum.TextXAlignment.Left
    L.TextColor3 = Color3.fromRGB(200,200,200)
    L.Parent = Content
end

local function Toggle(name,data)
    local Btn = Instance.new("TextButton")
    Btn.Size = UDim2.new(1,0,0,42)
    Btn.Text = name.." âŒ"
    Btn.Font = Enum.Font.GothamBold
    Btn.TextSize = 14
    Btn.TextColor3 = Color3.fromRGB(255,255,255)
    Btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
    Btn.Parent = Content
    Instance.new("UICorner",Btn).CornerRadius = UDim.new(0,10)

    Btn.MouseButton1Click:Connect(function()
        data.Enabled = not data.Enabled
        if data.Enabled then
            Btn.Text = name.." âœ”"
            Btn.BackgroundColor3 = Color3.fromRGB(0,180,120)
            if data.Func then data:Func(data) end
        else
            Btn.Text = name.." âŒ"
            Btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
            if data.StopFunc then data:StopFunc(data) end
        end
    end)
end

-- ====== å¥—ç”¨ Scripts ======
Section("ğŸ‘ è¦–è¦º")
Toggle("ç©å®¶ ESP", Scripts["ç©å®¶ ESP"])

Section("âš” æˆ°é¬¥")
Toggle("å¿«é€Ÿæ”»æ“Š", Scripts["å¿«é€Ÿæ”»æ“Š"])
Toggle("è‡ªå‹•v3", Scripts["è‡ªå‹•v3"])
Toggle("å¸ƒé­¯æ–¯æœ€æ„›çš„è‡ªç„", Scripts["å¸ƒé­¯æ–¯æœ€æ„›çš„è‡ªç„"])

Section("ğŸ›« ç§»å‹•")
Toggle("é£›è¡Œ GUI", Scripts["é£›è¡Œ GUI"])

-- ====== æ‹–å‹• ======
local dragging, dragStart, startPos
TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Main.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        Main.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- ====== é—œé–‰ / é–‹å•Ÿ ======
CloseBtn.MouseButton1Click:Connect(function()
    Main.Visible = false
end)

UserInputService.InputBegan:Connect(function(input,gp)
    if not gp and input.KeyCode == Enum.KeyCode.RightShift then
        Main.Visible = not Main.Visible
    end
end)
