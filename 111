-- ===============================
-- Clean Combat Assist (Rewrite)
-- ===============================

-- ===== Services =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- ===== Settings =====
local Settings = {
    Enabled = false,
    ToggleKey = Enum.KeyCode.RightShift,
    MaxDistance = 500,
}

-- ===== Character Utils =====
local function GetCharacter(player)
    return player.Character
end

local function IsAlive(char)
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    return hum and hum.Health > 0
end

-- ===== Find Nearest Enemy =====
local function FindNearestEnemy()
    local myChar = GetCharacter(LocalPlayer)
    local myHRP = myChar and myChar:FindFirstChild("HumanoidRootPart")
    if not myHRP then return nil end

    local closest, closestDist

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local char = GetCharacter(plr)
            local hrp = char and char:FindFirstChild("HumanoidRootPart")

            if hrp and IsAlive(char) then
                local dist = (hrp.Position - myHRP.Position).Magnitude
                if dist <= Settings.MaxDistance then
                    if not closestDist or dist < closestDist then
                        closest = plr
                        closestDist = dist
                    end
                end
            end
        end
    end

    return closest
end

-- ===== Aim At Target =====
local function AimAt(target)
    if not target then return end

    local char = target.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    Camera.CFrame = CFrame.new(
        Camera.CFrame.Position,
        hrp.Position
    )
end

-- ===== GUI =====
local Gui = Instance.new("ScreenGui")
Gui.Name = "CombatAssistGui"
Gui.ResetOnSpawn = false
Gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame", Gui)
Frame.Size = UDim2.fromScale(0.2, 0.15)
Frame.Position = UDim2.fromScale(0.4, 0.4)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.Active = true
Frame.Draggable = true

local Corner = Instance.new("UICorner", Frame)
Corner.CornerRadius = UDim.new(0, 12)

local ToggleBtn = Instance.new("TextButton", Frame)
ToggleBtn.Size = UDim2.fromScale(0.9, 0.4)
ToggleBtn.Position = UDim2.fromScale(0.05, 0.3)
ToggleBtn.Text = "Combat Assist : OFF"
ToggleBtn.TextScaled = true
ToggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)

local BtnCorner = Instance.new("UICorner", ToggleBtn)
BtnCorner.CornerRadius = UDim.new(0, 8)

-- ===== Toggle Logic =====
local function UpdateUI()
    ToggleBtn.Text = "Combat Assist : " .. (Settings.Enabled and "ON" or "OFF")
end

ToggleBtn.MouseButton1Click:Connect(function()
    Settings.Enabled = not Settings.Enabled
    UpdateUI()
end)

UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Settings.ToggleKey then
        Settings.Enabled = not Settings.Enabled
        UpdateUI()
    end
end)

-- ===== Main Loop =====
RunService.Heartbeat:Connect(function()
    if not Settings.Enabled then return end

    local target = FindNearestEnemy()
    AimAt(target)
end)

UpdateUI()

