-- ===== 基本服務 =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

local LocalPlayer = Players.LocalPlayer

-- ===== 設定 =====
local ESP_ENABLED = true
local TEXT_COLOR = Color3.fromRGB(255, 80, 80)
local TEXT_SIZE = 14

-- ===== ESP 容器 =====
local EspFolder = Instance.new("Folder")
EspFolder.Name = "ESP"
EspFolder.Parent = game.CoreGui

-- ===== 建立 ESP =====
local function createESP(player)
	if player == LocalPlayer then return end

	local billboard = Instance.new("BillboardGui")
	billboard.Name = player.Name .. "_ESP"
	billboard.AlwaysOnTop = true
	billboard.Size = UDim2.new(0, 200, 0, 50)
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.Parent = EspFolder

	local text = Instance.new("TextLabel")
	text.BackgroundTransparency = 1
	text.Size = UDim2.new(1, 0, 1, 0)
	text.TextColor3 = TEXT_COLOR
	text.TextStrokeTransparency = 0
	text.TextSize = TEXT_SIZE
	text.Font = Enum.Font.SourceSansBold
	text.Parent = billboard

	RunService.RenderStepped:Connect(function()
		if not ESP_ENABLED then
			billboard.Enabled = false
			return
		end

		if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local hrp = player.Character.HumanoidRootPart
			billboard.Adornee = hrp
			billboard.Enabled = true

			local distance = math.floor(
				(LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
			)

			text.Text = string.format("%s\n[%dm]", player.Name, distance)
		else
			billboard.Enabled = false
		end
	end)
end

-- ===== 初始化 =====
for _, plr in ipairs(Players:GetPlayers()) do
	createESP(plr)
end

Players.PlayerAdded:Connect(createESP)
