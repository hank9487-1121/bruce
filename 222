-- ===== Solara Auto V4 =====
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local toggleKey = "自动v4"
local autoV4Task

-- Toggle 狀態
local function getToggleState()
    _G.ToggleStates = _G.ToggleStates or {}
    return _G.ToggleStates[toggleKey] == true
end

-- 找 Awakening Tool
local function getAwakeningTool()
    local char = LocalPlayer.Character
    local backpack = LocalPlayer:FindFirstChild("Backpack")

    if char then
        local tool = char:FindFirstChild("Awakening")
        if tool then return tool end
    end

    if backpack then
        local tool = backpack:FindFirstChild("Awakening")
        if tool then return tool end
    end
end

-- Solara 安全呼叫方式
local function activateV4()
    local tool = getAwakeningTool()
    if not tool then return end

    -- 模擬正常啟動（Solara 吃這套）
    pcall(function()
        tool.Parent = LocalPlayer.Character
        task.wait()
        tool:Activate()
    end)
end

-- 開關控制
local function toggleAutoV4(enable)
    if autoV4Task then
        task.cancel(autoV4Task)
        autoV4Task = nil
    end

    if enable then
        autoV4Task = task.spawn(function()
            while getToggleState() do
                activateV4()
                task.wait(1.5) -- Solara 建議慢一點
            end
            autoV4Task = nil
        end)
    end
end

-- UI
Tabs.GeneralTab:Toggle({
    Title = "自動 v4（Solara）",
    Value = false,
    Callback = function(state)
        _G.ToggleStates = _G.ToggleStates or {}
        _G.ToggleStates[toggleKey] = state
        toggleAutoV4(state)
    end
})
